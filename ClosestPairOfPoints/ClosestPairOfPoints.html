<html>

<head>
    <title>ClosestPairOfPoints</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <style type="text/css">
        #myDiv {
            display: flex;
            flex-direction: column;
        }

        #div-random {
            display: flex;
            flex-direction: row;
        }

        #div-random button {
            width: 100%;
        }

        #div-random div {
            flex-shrink: 0;
        }

        canvas {
            background: #eee;
        }
    </style>
</head>

<body>
    <div id="myDiv">
        <canvas id="myCanvas"></canvas>

        <div>Habilita pontos <input type="checkbox" id="pointsEnable" class="refreshPoints" checked></div>
        <div>Raio dos pontos: <input type="number" id="pointRadius" class="refreshPoints" value="5"></div>
        <div>Largura da linha da solução: <input type="number" id="lineWidth" class="refreshPoints" value="2"></div>
        <div>Largura da círculo da solução: <input type="number" id="circleWidth" class="refreshPoints" value="5"></div>
        <div>Cor dos pontos: <input type="text" id="pointColor" class="refreshPoints" value="#0095DD"> </div>
        <div>Cor da solução: <input type="text" id="solutionColor" class="refreshPoints" value="#EE0000"> </div>

        <div id="div-random"><button id="random">Random</button>
            <div class="input">Número de pontos: <input type="number" id="pointCount" value="50"></div>
        </div>
        <button id="predefinido">Predefinido</button>
        <button id="clearSolution">Limpa Solução</spam></button>
        <button id="bruteForce">Força Bruta</spam></button>
        <button id="bruteForceMelhorado">Força Bruta (Melhorado)</spam></button>
        <button id="divideAndConquer">Divisão e Conquista</spam></button>
    </div>

    <script src="bruteForce.js"></script>
    <script src="divideAndConquer.js"></script>
    <script src="predefinido.js"></script>

    <script type="text/javascript">

        var WIDTH = 1800;
        var HEIGHT = 660;
        var activeSolution = null;
        var pointsEnabled = true;

        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        canvas.width = WIDTH;
        canvas.height = HEIGHT;

        var myDiv = document.getElementById("myDiv");
        myDiv.style.width = WIDTH;

        var params = {};
        var inputs = document.getElementsByTagName("input");
        for (let i = 0; i < inputs.length; i++) {
            let element = inputs[i];
            element.addEventListener("change", function (e) {
                params[element.id] = element.value;
            });
            params[element.id] = element.value;
        }
        var refreshPoints = document.getElementsByClassName("refreshPoints");
        for (let i = 0; i < refreshPoints.length; i++) {
            refreshPoints[i].addEventListener("change", function (e) {
                draw();
            });
        }

        document.getElementById("pointsEnable").addEventListener("change", () => {
            pointsEnabled = document.getElementById("pointsEnable").checked
            draw();
        });
        document.getElementById("random").addEventListener("click", () => {
            randomizePoints();
            activeSolution = null;
            draw();
        });
        document.getElementById("predefinido").addEventListener("click", () => {
            points = getPresetPoints();
            activeSolution = null;
            draw();
        });
        document.getElementById("clearSolution").addEventListener("click", () => {
            activeSolution = null;
            draw();
        });
        document.getElementById("bruteForce").addEventListener("click", () => {
            activeSolution = bruteForce(points);
            document.getElementById("bruteForce").innerHTML = "Força Bruta: " + activeSolution[3] + "ms, " + activeSolution[4] + " comparações";
            revealSolution(activeSolution);
        });
        document.getElementById("bruteForceMelhorado").addEventListener("click", () => {
            activeSolution = bruteForceMelhorado(points);
            document.getElementById("bruteForceMelhorado").innerHTML = "Força Bruta (Melhorado): " + activeSolution[3] + "ms, " + activeSolution[4] + " comparações";
            revealSolution(activeSolution);
        });
        document.getElementById("divideAndConquer").addEventListener("click", () => {
            activeSolution = closestDivideAndConquer(points, WIDTH);
            document.getElementById("divideAndConquer").innerHTML = "Divisão e Conquista: " + activeSolution[3] + "ms, " + activeSolution[4] + " comparações";
            revealSolution(activeSolution);
        });

    </script>

    <script type="text/javascript">

        var points = getPresetPoints();
        draw();

        function getPresetPoints() {
            let points = [];
            for (let i = 0; i < predefinido.length; i++) {
                points[i] = { x: predefinido[i].x * WIDTH, y: predefinido[i].y * HEIGHT };
            }
            return points;
        }

        function randomizePoints() {
            //let pointsString = "";
            pointCount = params["pointCount"];
            points = [];
            for (let i = 0; i < pointCount; i++) {
                let x = Math.random(), y = Math.random();
                points[i] = { x: x * WIDTH, y: y * HEIGHT };
                //pointsString += `{x:${x}, y:${y}},\n`;
            }
            //console.log(pointsString.substring(0, pointsString.length - 2))
        }

        function drawPoints() {
            for (var i = 0; i < points.length; i++) {
                var point = points[i];
                drawPoint(point, params["pointColor"])
            }
        }

        function drawPoint(point, color) {
            let pointRadius = params["pointRadius"];
            ctx.beginPath();
            ctx.arc(point.x, point.y, pointRadius, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.closePath()
        }

        function drawLine(p0, p1, color) {
            ctx.beginPath();
            ctx.moveTo(p0.x, p0.y);
            ctx.lineTo(p1.x, p1.y);
            ctx.lineWidth = params["lineWidth"];
            ctx.strokeStyle = color;
            ctx.stroke();
            ctx.closePath()
        }

        function revealSolution(solution) {
            let { pointRadius, circleWidth, solutionColor } = params;

            drawPoint(solution[0], solutionColor);
            drawPoint(solution[1], solutionColor);
            drawLine(solution[0], solution[1], solutionColor);

            let centerX = (solution[0].x + solution[1].x) / 2
            let centerY = (solution[0].y + solution[1].y) / 2
            let radius = parseInt(circleWidth) * 2 + parseInt(pointRadius) + Math.sqrt(Math.pow(solution[1].x - solution[0].x, 2) + Math.pow(solution[1].y - solution[0].y, 2)) / 2

            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.lineWidth = circleWidth;
            ctx.stroke();
            ctx.closePath();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (pointsEnabled)
                drawPoints();
            if (activeSolution)
                revealSolution(activeSolution);
        }

    </script>

</body>

</html>